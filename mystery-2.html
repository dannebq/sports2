<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herrg√•rdens Hemlighet - Tidsmysteriet</title>
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    
    <!-- Web App Capable -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Tidsmysteriet">
    
    <!-- React and Babel for JSX -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        .back-button {
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 100;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            font-size: 20px;
            transition: transform 0.2s;
        }
        .back-button:hover {
            transform: scale(1.1);
        }
        @keyframes bounce-subtle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .animate-bounce-subtle {
            animation: bounce-subtle 2s infinite;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button" title="Tillbaka till Sport">‚Üê</a>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, Fragment } = React;
        
        // Icon components
        const Clock = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
            </svg>
        );
        
        const MapPin = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                <circle cx="12" cy="10" r="3"/>
            </svg>
        );
        
        const User = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
        );
        
        const CheckCircle = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
        );
        
        const HelpCircle = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"/>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
        );
        
        const XCircle = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"/>
                <line x1="15" y1="9" x2="9" y2="15"/>
                <line x1="9" y1="9" x2="15" y2="15"/>
            </svg>
        );
        
        const Play = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polygon points="5 3 19 12 5 21 5 3"/>
            </svg>
        );
        
        const RotateCcw = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="1 4 1 10 7 10"/>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
            </svg>
        );
        
        const BookOpen = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
            </svg>
        );
        
        const Shield = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            </svg>
        );
        
        const Scroll = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4"/>
                <path d="M19 17V5a2 2 0 0 0-2-2H4"/>
            </svg>
        );

        // === KONSTANTER & SPELDATA ===

        const LOCATIONS = [
          { id: 'greenhouse', name: 'V√§xthuset', color: 'bg-emerald-200', borderColor: 'border-emerald-400', icon: 'üåø' },
          { id: 'library', name: 'Biblioteket', color: 'bg-amber-100', borderColor: 'border-amber-400', icon: 'üìö' },
          { id: 'cellar', name: 'Vink√§llaren', color: 'bg-red-100', borderColor: 'border-red-400', icon: 'üç∑' },
          { id: 'billiards', name: 'Biljardrummet', color: 'bg-blue-100', borderColor: 'border-blue-400', icon: 'üé±' }
        ];

        const TIMES = ['20:00', '21:00', '22:00'];

        const SUSPECTS = [
          { id: 'countess', name: 'Grevinnan', color: 'text-purple-600', bgColor: 'bg-purple-100' },
          { id: 'butler', name: 'Butlern', color: 'text-slate-700', bgColor: 'bg-slate-100' },
          { id: 'general', name: 'Generalen', color: 'text-green-700', bgColor: 'bg-green-100' },
          { id: 'doctor', name: 'Doktorn', color: 'text-blue-700', bgColor: 'bg-blue-100' }
        ];

        // Det korrekta facit f√∂r detta sv√•ra fall
        const SOLUTION = {
          // General: Cellar -> Billiards -> Library
          'general-0': 'cellar', 'general-1': 'billiards', 'general-2': 'library',
          // Countess: Greenhouse -> Cellar -> Billiards
          'countess-0': 'greenhouse', 'countess-1': 'cellar', 'countess-2': 'billiards',
          // Butler: Library -> Greenhouse -> Cellar
          'butler-0': 'library', 'butler-1': 'greenhouse', 'butler-2': 'cellar',
          // Doctor: Billiards -> Library -> Greenhouse (F√∂ljer Butlern 1h efter)
          'doctor-0': 'billiards', 'doctor-1': 'library', 'doctor-2': 'greenhouse'
        };

        const CLUES = [
          { id: 1, text: "MORDET: Baronen hittades m√∂rdad i Vink√§llaren klockan 21:00.", important: true },
          { id: 2, text: "MOTIV: Doktorn misstror Butlern och befann sig alltid i det rum som Butlern l√§mnade en timme tidigare.", important: true },
          { id: 3, text: "Doktorn inledde sitt s√∂kande (20:00) i Biljardrummet.", important: false },
          { id: 4, text: "Grevinnan s√•gs leta efter testamentet i V√§xthuset klockan 20:00.", important: false },
          { id: 5, text: "Vid 22:00 satt Generalen i Biblioteket och Doktorn i V√§xthuset.", important: false },
          { id: 6, text: "Butlern befann sig i Biblioteket klockan 20:00 f√∂r att st√§da.", important: false },
          { id: 7, text: "REGEL: Alla letar desperat p√• 3 olika platser. Ingen g√•r tillbaka till ett rum de redan genoms√∂kt.", important: true },
          { id: 8, text: "REGEL: Endast en person per rum och tidpunkt (de undviker varandra).", important: true }
        ];

        function ShadowGame() {
          const [gridState, setGridState] = useState({});
          const [gameState, setGameState] = useState('playing'); // playing, won, lost
          const [checkedClues, setCheckedClues] = useState({});
          const [showIntro, setShowIntro] = useState(true);

          // Initiera tomt rutn√§t
          useEffect(() => {
            initializeGrid();
          }, []);

          const initializeGrid = () => {
            const initialGrid = {};
            SUSPECTS.forEach(suspect => {
              TIMES.forEach((_, timeIndex) => {
                initialGrid[`${suspect.id}-${timeIndex}`] = null;
              });
            });
            setGridState(initialGrid);
            setGameState('playing');
            setCheckedClues({});
          };

          const handleCellClick = (suspectId, timeIndex) => {
            if (gameState !== 'playing') return;

            const key = `${suspectId}-${timeIndex}`;
            const currentLocationId = gridState[key];
            
            let nextLocationId;
            if (!currentLocationId) {
              nextLocationId = LOCATIONS[0].id;
            } else {
              const currentIndex = LOCATIONS.findIndex(l => l.id === currentLocationId);
              if (currentIndex === LOCATIONS.length - 1) {
                nextLocationId = null; 
              } else {
                nextLocationId = LOCATIONS[currentIndex + 1].id;
              }
            }

            setGridState(prev => ({
              ...prev,
              [key]: nextLocationId
            }));
          };

          const checkSolution = () => {
            let isCorrect = true;
            let isComplete = true;

            Object.keys(SOLUTION).forEach(key => {
              if (!gridState[key]) {
                isComplete = false;
              } else if (gridState[key] !== SOLUTION[key]) {
                isCorrect = false;
              }
            });

            if (!isComplete) {
              alert("Du m√•ste fylla i alla rutor innan du kan l√∂sa fallet!");
              return;
            }

            setGameState(isCorrect ? 'won' : 'lost');
          };

          const toggleClue = (id) => {
            setCheckedClues(prev => ({...prev, [id]: !prev[id]}));
          };

          const getKillerName = () => "Grevinnan";

          if (showIntro) {
            return (
              <div className="min-h-screen bg-slate-950 flex items-center justify-center p-4 font-sans">
                <div className="max-w-xl w-full bg-slate-900 rounded-xl shadow-2xl overflow-hidden border border-slate-800">
                  <div className="bg-slate-950 p-8 text-center relative overflow-hidden">
                    <div className="absolute inset-0 opacity-10 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-indigo-500 via-slate-950 to-slate-950"></div>
                    <h1 className="text-2xl sm:text-3xl font-bold text-indigo-100 mb-2 tracking-wider relative z-10 uppercase">Herrg√•rdens Hemlighet</h1>
                  </div>
                  <div className="p-8 space-y-6">
                    <div className="text-left space-y-4 text-slate-300">
                      <h3 className="font-bold text-lg text-white flex items-center gap-2">
                        <Scroll size={20} className="text-amber-500" /> Bakgrunden
                      </h3>
                      <p className="text-sm leading-relaxed">
                        Baron Cornelius von Silver bj√∂d in sina arvingar till middag. Men kv√§llen urartade snabbt n√§r g√§sterna blev ov√§nner under huvudr√§tten.
                      </p>
                      <p className="text-sm leading-relaxed">
                        Mitt i gr√§let avsl√∂jade Baronen att han skrivit ett <strong>nytt testamente</strong> som g√∂r dem alla arvl√∂sa, och att dokumentet redan finns g√∂mt n√•gonstans p√• herrg√•rden.
                      </p>
                      <p className="text-sm leading-relaxed">
                        Panik utbr√∂t och alla spreds f√∂r att leta. Men klockan <strong>21:00</strong> hittades Baronen d√∂d i <strong>Vink√§llaren</strong>. Din uppgift √§r att lista ut vem som var d√§r.
                      </p>
                    </div>

                    <div className="bg-slate-800 p-4 rounded border border-slate-700 text-sm">
                       <p className="text-indigo-300 font-bold mb-1">Viktig detalj:</p>
                       <p className="text-slate-400 italic">Doktorn litar inte p√• Butlern och har d√§rf√∂r skuggat honom (f√∂ljt efter honom med 1 timmes f√∂rdr√∂jning) hela kv√§llen.</p>
                    </div>
                    
                    <button 
                      onClick={() => setShowIntro(false)}
                      className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-6 rounded-lg transition-all transform hover:scale-105 flex items-center justify-center gap-2 shadow-lg border border-indigo-500/50"
                    >
                      <Play size={20} /> STARTA UTREDNINGEN
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-slate-100 pb-12 font-sans">
              {/* Header */}
              <header className="bg-slate-900 text-white p-4 shadow-lg sticky top-0 z-10 border-b border-indigo-900">
                <div className="max-w-4xl mx-auto flex justify-between items-center">
                  <div className="ml-10">
                    <h1 className="text-lg sm:text-xl font-bold tracking-wider text-indigo-100 uppercase">Herrg√•rdens Hemlighet</h1>
                    <p className="text-xs text-indigo-300">Fall: Det f√∂rsvunna testamentet</p>
                  </div>
                  <button onClick={initializeGrid} className="p-2 hover:bg-slate-800 rounded-full text-slate-400 hover:text-white" title="B√∂rja om">
                    <RotateCcw size={20} />
                  </button>
                </div>
              </header>

              <main className="max-w-4xl mx-auto p-4 space-y-6">

                {/* Mission Briefing */}
                <div className="bg-white border-l-4 border-indigo-600 rounded-r-lg p-5 shadow-sm">
                  <h3 className="font-bold text-slate-800 flex items-center gap-2 mb-2">
                    <Shield size={18} className="text-indigo-600" /> Ditt Uppdrag
                  </h3>
                  <p className="text-slate-600 text-sm mb-3">
                    Identifiera vem som befann sig i <strong>Vink√§llaren</strong> klockan <strong>21:00</strong>.
                  </p>
                </div>
                
                {/* Game Grid */}
                <div className="bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden">
                  <div className="grid grid-cols-[80px_repeat(3,1fr)] sm:grid-cols-[120px_repeat(3,1fr)] divide-x divide-slate-200">
                    
                    {/* Header Row */}
                    <div className="bg-slate-50 p-2 sm:p-4 flex items-center justify-center font-bold text-slate-400 border-b border-slate-200">
                      <User size={20} />
                    </div>
                    {TIMES.map((time, i) => (
                      <div key={i} className={`p-2 sm:p-3 text-center font-bold text-slate-700 border-b border-slate-200 ${i === 1 ? 'bg-red-50 text-red-700 border-red-100 ring-2 ring-inset ring-red-100' : 'bg-slate-50'}`}>
                        <div className="flex flex-col items-center">
                          <Clock size={16} className="mb-1 opacity-50" />
                          {time}
                        </div>
                        {i === 1 && <span className="text-[9px] sm:text-[10px] uppercase font-black tracking-widest text-red-500 block mt-1">MORDET</span>}
                      </div>
                    ))}

                    {/* Suspect Rows */}
                    {SUSPECTS.map((suspect) => (
                      <Fragment key={suspect.id}>
                        {/* Name Column */}
                        <div className={`${suspect.bgColor} p-2 sm:p-4 flex flex-col justify-center border-b border-slate-100`}>
                          <span className={`font-bold text-xs sm:text-base ${suspect.color}`}>{suspect.name}</span>
                        </div>

                        {/* Interactive Cells */}
                        {TIMES.map((time, timeIndex) => {
                          const cellKey = `${suspect.id}-${timeIndex}`;
                          const locId = gridState[cellKey];
                          const location = LOCATIONS.find(l => l.id === locId);

                          return (
                            <div 
                              key={cellKey}
                              onClick={() => handleCellClick(suspect.id, timeIndex)}
                              className={`
                                relative h-20 sm:h-32 border-b border-slate-100 cursor-pointer transition-all duration-200 
                                flex flex-col items-center justify-center text-center p-1 group
                                ${!location ? 'hover:bg-slate-50' : ''}
                                ${location ? location.color : 'bg-white'}
                                ${gameState !== 'playing' ? 'cursor-default' : 'cursor-pointer active:scale-95'}
                              `}
                            >
                              {location ? (
                                <>
                                  <span className="text-xl sm:text-3xl mb-1 drop-shadow-sm transition-transform duration-300 transform scale-100 group-hover:scale-110">{location.icon}</span>
                                  <span className="text-[10px] sm:text-sm font-semibold text-slate-800 leading-tight hidden sm:block">{location.name}</span>
                                </>
                              ) : (
                                <span className="text-slate-200 group-hover:text-slate-300">
                                  <MapPin size={24} />
                                </span>
                              )}
                              {/* Mobile hint */}
                              {!location && gameState === 'playing' && (
                                <span className="absolute bottom-1 right-1 text-[8px] text-slate-300 opacity-0 group-hover:opacity-100">
                                  Klicka
                                </span>
                              )}
                            </div>
                          );
                        })}
                      </Fragment>
                    ))}
                  </div>
                </div>

                {/* Legend */}
                <div className="grid grid-cols-2 sm:grid-cols-4 gap-2">
                  {LOCATIONS.map(loc => (
                    <div key={loc.id} className={`${loc.color} p-2 rounded border ${loc.borderColor} text-xs font-bold text-center flex items-center justify-center gap-2 opacity-80 shadow-sm`}>
                      <span>{loc.icon}</span> {loc.name}
                    </div>
                  ))}
                </div>

                {/* Clues */}
                <div className="bg-white rounded-xl shadow-md border border-slate-200 p-6">
                  <h2 className="font-bold text-lg mb-4 flex items-center gap-2 text-slate-800">
                    <BookOpen size={20} className="text-indigo-600" />
                    Vittnesm√•l & Faktan
                  </h2>
                  <div className="space-y-3">
                    {CLUES.map((clue) => (
                      <div 
                        key={clue.id} 
                        onClick={() => toggleClue(clue.id)}
                        className={`
                          flex items-start gap-3 p-3 rounded-lg cursor-pointer transition-all select-none border border-transparent
                          ${checkedClues[clue.id] ? 'bg-slate-50 opacity-40' : 'bg-indigo-50 hover:bg-white hover:border-indigo-200 hover:shadow-sm'}
                          ${clue.important ? 'border-l-4 border-l-indigo-400' : ''}
                        `}
                      >
                        <div className={`mt-1 w-5 h-5 rounded border flex items-center justify-center flex-shrink-0 transition-colors ${checkedClues[clue.id] ? 'bg-slate-400 border-slate-400' : 'bg-white border-indigo-200'}`}>
                          {checkedClues[clue.id] && <CheckCircle size={14} className="text-white" />}
                        </div>
                        <p className={`text-sm leading-relaxed ${checkedClues[clue.id] ? 'text-slate-400 line-through' : 'text-slate-700'}`}>
                          {clue.text}
                        </p>
                      </div>
                    ))}
                  </div>
                </div>

                {/* Action Button */}
                <div className="sticky bottom-6">
                  {gameState === 'playing' && (
                    <button 
                      onClick={checkSolution}
                      className="w-full bg-slate-900 text-white font-bold py-4 rounded-xl shadow-xl hover:bg-slate-800 transition-all transform hover:scale-[1.01] flex items-center justify-center gap-2 border border-slate-700"
                    >
                      <HelpCircle size={20} /> L√ñS FALLET
                    </button>
                  )}

                  {gameState === 'won' && (
                    <div className="bg-emerald-600 text-white p-6 rounded-xl shadow-2xl text-center animate-bounce-subtle border border-emerald-500">
                      <h3 className="text-2xl font-bold mb-2 flex items-center justify-center gap-2">
                        <CheckCircle size={28} /> FALLET L√ñST!
                      </h3>
                      <p className="mb-4 text-emerald-100">Du har framg√•ngsrikt rekonstruerat h√§ndelsef√∂rloppet.</p>
                      <div className="bg-emerald-800/50 p-4 rounded-lg backdrop-blur-sm">
                        <p className="text-xs uppercase tracking-widest opacity-80 mb-1 text-emerald-200">DEN SKYLDIGE √ÑR</p>
                        <p className="text-3xl font-black">{getKillerName()}</p>
                        <p className="text-sm mt-2 opacity-90 text-emerald-100">Endast hon var i Vink√§llaren vid mordtillf√§llet.</p>
                        <p className="text-xs mt-4 italic opacity-70">Motiv: Arvet.</p>
                      </div>
                      <button onClick={initializeGrid} className="mt-4 text-sm underline opacity-80 hover:opacity-100">Spela igen</button>
                    </div>
                  )}

                  {gameState === 'lost' && (
                    <div className="bg-red-600 text-white p-6 rounded-xl shadow-2xl text-center border border-red-500">
                      <h3 className="text-2xl font-bold mb-2 flex items-center justify-center gap-2">
                        <XCircle size={28} /> FELAKTIGT
                      </h3>
                      <p className="mb-4 text-red-100">Din tidslinje inneh√•ller logiska fel. <br/>Har du dubbelkollat att Doktorn alltid √§r ett steg bakom Butlern?</p>
                      <button 
                        onClick={() => setGameState('playing')}
                        className="bg-white text-red-600 px-6 py-2 rounded-lg font-bold hover:bg-red-50 shadow-lg"
                      >
                        Forts√§tt utreda
                      </button>
                    </div>
                  )}
                </div>

              </main>
            </div>
          );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ShadowGame />);
    </script>
</body>
</html>

