<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mordet i V√§xthuset - Tidsmysteriet</title>
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    
    <!-- Web App Capable -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Tidsmysteriet">
    
    <!-- React and Babel for JSX -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.min.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        .back-button {
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 100;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            font-size: 20px;
            transition: transform 0.2s;
        }
        .back-button:hover {
            transform: scale(1.1);
        }
        @keyframes bounce-subtle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .animate-bounce-subtle {
            animation: bounce-subtle 2s infinite;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button" title="Tillbaka till Sport">‚Üê</a>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, Fragment } = React;
        
        // Icon components (simplified versions)
        const Clock = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
            </svg>
        );
        
        const MapPin = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                <circle cx="12" cy="10" r="3"/>
            </svg>
        );
        
        const User = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
        );
        
        const CheckCircle = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
        );
        
        const HelpCircle = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"/>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
        );
        
        const XCircle = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"/>
                <line x1="15" y1="9" x2="9" y2="15"/>
                <line x1="9" y1="9" x2="15" y2="15"/>
            </svg>
        );
        
        const Play = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polygon points="5 3 19 12 5 21 5 3"/>
            </svg>
        );
        
        const RotateCcw = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="1 4 1 10 7 10"/>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
            </svg>
        );
        
        const BookOpen = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
            </svg>
        );
        
        const Info = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="16" x2="12" y2="12"/>
                <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
        );

        // Speldata och konstanter
        const SUSPECTS = [
          { id: 'countess', name: 'Grevinnan', color: 'text-purple-600', bgColor: 'bg-purple-100' },
          { id: 'butler', name: 'Butlern', color: 'text-slate-700', bgColor: 'bg-slate-100' },
          { id: 'general', name: 'Generalen', color: 'text-green-700', bgColor: 'bg-green-100' }
        ];

        const TIMES = ['20:00', '21:00', '22:00'];

        const LOCATIONS = [
          { id: 'greenhouse', name: 'V√§xthuset', color: 'bg-emerald-200', borderColor: 'border-emerald-400', icon: 'üåø' },
          { id: 'library', name: 'Biblioteket', color: 'bg-amber-100', borderColor: 'border-amber-400', icon: 'üìö' },
          { id: 'cellar', name: 'Vink√§llaren', color: 'bg-red-100', borderColor: 'border-red-400', icon: 'üç∑' },
          { id: 'billiards', name: 'Biljardrummet', color: 'bg-blue-100', borderColor: 'border-blue-400', icon: 'üé±' }
        ];

        // Det korrekta facit f√∂r just detta "dagliga" pussel
        const SOLUTION = {
          'countess-0': 'billiards', 'countess-1': 'greenhouse', 'countess-2': 'cellar',
          'butler-0': 'cellar',     'butler-1': 'library',     'butler-2': 'greenhouse',
          'general-0': 'greenhouse', 'general-1': 'cellar',    'general-2': 'billiards'
        };

        const CLUES = [
          { id: 1, text: "FAKTA: Mordet skedde i V√§xthuset klockan 21:00 (N√•gon m√•ste vara d√§r d√•).", important: true },
          { id: 2, text: "Generalen startade i V√§xthuset (20:00), men gick sedan till Vink√§llaren (21:00).", important: false },
          { id: 3, text: "Butlern hittade kroppen i V√§xthuset klockan 22:00.", important: false },
          { id: 4, text: "Grevinnan var i Vink√§llaren klockan 22:00.", important: false },
          { id: 5, text: "Vid tiden f√∂r mordet (21:00) satt Butlern i Biblioteket.", important: true },
          { id: 6, text: "Klockan 20:00 befann sig Grevinnan i Biljardrummet och Butlern i Vink√§llaren.", important: false },
          { id: 7, text: "Generalen avslutade kv√§llen (22:00) i Biljardrummet.", important: false },
          { id: 8, text: "REGEL: Tv√• personer √§r aldrig i samma rum samtidigt.", important: true },
          { id: 9, text: "REGEL: Varje person bes√∂ker 3 olika rum (ingen g√•r tillbaka till ett rum de redan varit i).", important: true }
        ];

        function TimeMysteryGame() {
          const [gridState, setGridState] = useState({});
          const [gameState, setGameState] = useState('playing'); // playing, won, lost
          const [checkedClues, setCheckedClues] = useState({});
          const [showIntro, setShowIntro] = useState(true);

          // Initiera tomt rutn√§t
          useEffect(() => {
            const initialGrid = {};
            SUSPECTS.forEach(suspect => {
              TIMES.forEach((_, timeIndex) => {
                initialGrid[`${suspect.id}-${timeIndex}`] = null;
              });
            });
            setGridState(initialGrid);
          }, []);

          // Hantera klick p√• en ruta (cykla genom platser)
          const handleCellClick = (suspectId, timeIndex) => {
            if (gameState !== 'playing') return;

            const key = `${suspectId}-${timeIndex}`;
            const currentLocationId = gridState[key];
            
            let nextLocationId;
            if (!currentLocationId) {
              nextLocationId = LOCATIONS[0].id;
            } else {
              const currentIndex = LOCATIONS.findIndex(l => l.id === currentLocationId);
              if (currentIndex === LOCATIONS.length - 1) {
                nextLocationId = null; // Tillbaka till tom
              } else {
                nextLocationId = LOCATIONS[currentIndex + 1].id;
              }
            }

            setGridState(prev => ({
              ...prev,
              [key]: nextLocationId
            }));
          };

          // Kontrollera l√∂sningen
          const checkSolution = () => {
            let isCorrect = true;
            let isComplete = true;

            // Kontrollera om alla rutor √§r ifyllda och om de √§r r√§tt
            Object.keys(SOLUTION).forEach(key => {
              if (!gridState[key]) {
                isComplete = false;
              } else if (gridState[key] !== SOLUTION[key]) {
                isCorrect = false;
              }
            });

            if (!isComplete) {
              alert("Du m√•ste fylla i alla rutor innan du gissar!");
              return;
            }

            if (isCorrect) {
              setGameState('won');
            } else {
              setGameState('lost');
            }
          };

          const resetGame = () => {
            const initialGrid = {};
            SUSPECTS.forEach(suspect => {
              TIMES.forEach((_, timeIndex) => {
                initialGrid[`${suspect.id}-${timeIndex}`] = null;
              });
            });
            setGridState(initialGrid);
            setGameState('playing');
            setCheckedClues({});
          };

          const toggleClue = (id) => {
            setCheckedClues(prev => ({...prev, [id]: !prev[id]}));
          };

          // Hitta m√∂rdaren baserat p√• l√∂sningen (Den som √§r i V√§xthuset kl 21:00)
          const getKillerName = () => {
            return "Grevinnan"; 
          };

          if (showIntro) {
            return (
              <div className="min-h-screen bg-slate-900 flex items-center justify-center p-4">
                <div className="max-w-md w-full bg-white rounded-xl shadow-2xl overflow-hidden">
                  <div className="bg-slate-800 p-6 text-center">
                    <h1 className="text-3xl font-bold text-white mb-2 tracking-wider">TIDSMYSTERIET</h1>
                    <div className="text-slate-400 text-sm font-mono">DAGLIG UTMANING #42</div>
                  </div>
                  <div className="p-8 space-y-6">
                    <div className="text-center">
                      <div className="bg-red-50 text-red-800 p-4 rounded-lg border border-red-200 mb-4">
                        <h3 className="font-bold flex items-center justify-center gap-2 mb-2">
                          <span className="text-2xl">üö®</span> MORDET
                        </h3>
                        <p>Herrg√•rds√§garen hittades d√∂d i <strong>V√§xthuset</strong>.</p>
                        <p>D√∂dstidpunkten √§r fastst√§lld till <strong>21:00</strong>.</p>
                      </div>
                      <p className="text-slate-600">
                        Du m√•ste lista ut var varje misst√§nkt befann sig vid varje klockslag f√∂r att hitta m√∂rdaren som saknar alibi.
                      </p>
                    </div>
                    
                    <button 
                      onClick={() => setShowIntro(false)}
                      className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-6 rounded-lg transition-all transform hover:scale-105 flex items-center justify-center gap-2 shadow-lg"
                    >
                      <Play size={20} /> STARTA UTREDNINGEN
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-slate-100 pb-12 font-sans">
              {/* Header */}
              <header className="bg-slate-900 text-white p-4 shadow-lg sticky top-0 z-10">
                <div className="max-w-4xl mx-auto flex justify-between items-center">
                  <div className="ml-10">
                    <h1 className="text-xl font-bold tracking-wider">TIDSMYSTERIET</h1>
                    <p className="text-xs text-slate-400">Mord i V√§xthuset kl 21:00</p>
                  </div>
                  <div className="flex gap-2">
                    <button onClick={resetGame} className="p-2 hover:bg-slate-800 rounded-full text-slate-400 hover:text-white" title="√Öterst√§ll">
                      <RotateCcw size={20} />
                    </button>
                  </div>
                </div>
              </header>

              <main className="max-w-4xl mx-auto p-4 space-y-6">

                {/* Rules Explanation Box */}
                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm text-blue-900 shadow-sm">
                  <h3 className="font-bold mb-2 flex items-center gap-2 text-blue-800">
                    <Info size={18} /> S√• h√§r spelar du:
                  </h3>
                  <ul className="list-disc list-inside space-y-1 ml-1 opacity-90 leading-relaxed">
                    <li><strong>Klicka p√• rutorna</strong> i rutn√§tet f√∂r att byta plats tills du hittat r√§tt.</li>
                    <li>Anv√§nd <strong>ledtr√•darna</strong> nedan f√∂r att utesluta eller bekr√§fta platser.</li>
                    <li><strong>REGEL 1:</strong> Tv√• personer kan aldrig vara i samma rum samtidigt.</li>
                    <li><strong>REGEL 2:</strong> En person bes√∂ker aldrig samma rum tv√• g√•nger.</li>
                    <li>M√•let √§r att hitta vem som saknar alibi f√∂r mordet i V√§xthuset kl 21:00.</li>
                  </ul>
                </div>
                
                {/* Game Area Grid */}
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                  <div className="grid grid-cols-[100px_repeat(3,1fr)] divide-x divide-slate-200">
                    
                    {/* Header Row */}
                    <div className="bg-slate-50 p-4 flex items-center justify-center font-bold text-slate-400 border-b border-slate-200">
                      <User size={20} />
                    </div>
                    {TIMES.map((time, i) => (
                      <div key={i} className={`p-3 text-center font-bold text-slate-700 border-b border-slate-200 ${i === 1 ? 'bg-red-50 text-red-700 border-red-100 ring-2 ring-inset ring-red-100' : 'bg-slate-50'}`}>
                        <div className="flex flex-col items-center">
                          <Clock size={16} className="mb-1 opacity-50" />
                          {time}
                        </div>
                        {i === 1 && <span className="text-[10px] uppercase font-black tracking-widest text-red-500 block mt-1">MORDET</span>}
                      </div>
                    ))}

                    {/* Suspect Rows */}
                    {SUSPECTS.map((suspect) => (
                      <Fragment key={suspect.id}>
                        {/* Name Column */}
                        <div className={`${suspect.bgColor} p-4 flex flex-col justify-center border-b border-slate-100`}>
                          <span className={`font-bold ${suspect.color}`}>{suspect.name}</span>
                        </div>

                        {/* Time Slots (Interactive Cells) */}
                        {TIMES.map((time, timeIndex) => {
                          const cellKey = `${suspect.id}-${timeIndex}`;
                          const locId = gridState[cellKey];
                          const location = LOCATIONS.find(l => l.id === locId);

                          return (
                            <div 
                              key={cellKey}
                              onClick={() => handleCellClick(suspect.id, timeIndex)}
                              className={`
                                relative h-24 sm:h-32 border-b border-slate-100 cursor-pointer transition-all duration-200 
                                flex flex-col items-center justify-center text-center p-2 group
                                ${!location ? 'hover:bg-slate-50' : ''}
                                ${location ? location.color : 'bg-white'}
                                ${gameState !== 'playing' ? 'cursor-default' : 'cursor-pointer active:scale-95'}
                              `}
                            >
                              {location ? (
                                <>
                                  <span className="text-2xl sm:text-3xl mb-1 drop-shadow-sm transition-transform duration-300 transform scale-100 group-hover:scale-110">{location.icon}</span>
                                  <span className="text-xs sm:text-sm font-semibold text-slate-800 leading-tight">{location.name}</span>
                                </>
                              ) : (
                                <span className="text-slate-200 group-hover:text-slate-300">
                                  <MapPin size={24} />
                                </span>
                              )}
                              
                              {/* Mobile tap hint */}
                              {!location && gameState === 'playing' && (
                                <span className="absolute bottom-1 right-1 text-[10px] text-slate-300 opacity-0 group-hover:opacity-100 transition-opacity">
                                  Klicka
                                </span>
                              )}
                            </div>
                          );
                        })}
                      </Fragment>
                    ))}
                  </div>
                </div>

                {/* Legend / Tools */}
                <div className="grid grid-cols-2 sm:grid-cols-4 gap-2">
                  {LOCATIONS.map(loc => (
                    <div key={loc.id} className={`${loc.color} p-2 rounded border ${loc.borderColor} text-xs font-bold text-center flex items-center justify-center gap-2 opacity-80`}>
                      <span>{loc.icon}</span> {loc.name}
                    </div>
                  ))}
                </div>

                {/* Clues Section */}
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                  <h2 className="font-bold text-lg mb-4 flex items-center gap-2">
                    <BookOpen size={20} className="text-indigo-600" />
                    Vittnesm√•l & Ledtr√•dar
                  </h2>
                  <div className="space-y-3">
                    {CLUES.map((clue) => (
                      <div 
                        key={clue.id} 
                        onClick={() => toggleClue(clue.id)}
                        className={`
                          flex items-start gap-3 p-3 rounded-lg cursor-pointer transition-all select-none
                          ${checkedClues[clue.id] ? 'bg-slate-50 opacity-50' : 'bg-indigo-50/50 hover:bg-indigo-50'}
                          ${clue.important ? 'border-l-4 border-red-400' : ''}
                        `}
                      >
                        <div className={`mt-1 w-5 h-5 rounded border flex items-center justify-center flex-shrink-0 ${checkedClues[clue.id] ? 'bg-slate-400 border-slate-400' : 'bg-white border-indigo-200'}`}>
                          {checkedClues[clue.id] && <CheckCircle size={14} className="text-white" />}
                        </div>
                        <p className={`text-sm ${checkedClues[clue.id] ? 'text-slate-400 line-through' : 'text-slate-700'}`}>
                          {clue.text}
                        </p>
                      </div>
                    ))}
                  </div>
                </div>

                {/* Action Button */}
                <div className="sticky bottom-4">
                  {gameState === 'playing' && (
                    <button 
                      onClick={checkSolution}
                      className="w-full bg-slate-900 text-white font-bold py-4 rounded-xl shadow-xl hover:bg-slate-800 transition-colors flex items-center justify-center gap-2"
                    >
                      <HelpCircle size={20} /> L√ñS FALLET
                    </button>
                  )}

                  {gameState === 'won' && (
                    <div className="bg-green-600 text-white p-6 rounded-xl shadow-xl text-center animate-bounce-subtle">
                      <h3 className="text-2xl font-bold mb-2 flex items-center justify-center gap-2">
                        <CheckCircle size={28} /> KORREKT!
                      </h3>
                      <p className="mb-4">Du har kartlagt alla r√∂relser korrekt.</p>
                      <div className="bg-green-700/50 p-4 rounded-lg">
                        <p className="text-sm uppercase tracking-widest opacity-80 mb-1">M√ñRDAREN √ÑR</p>
                        <p className="text-3xl font-black">{getKillerName()}</p>
                        <p className="text-sm mt-2 opacity-90">Hon var ensam i V√§xthuset kl 21:00.</p>
                      </div>
                      <button onClick={resetGame} className="mt-4 text-sm underline opacity-80 hover:opacity-100">Spela igen (√Öterst√§ll)</button>
                    </div>
                  )}

                  {gameState === 'lost' && (
                    <div className="bg-red-600 text-white p-6 rounded-xl shadow-xl text-center">
                      <h3 className="text-2xl font-bold mb-2 flex items-center justify-center gap-2">
                        <XCircle size={28} /> FELAKTIGT
                      </h3>
                      <p className="mb-4">Din tidslinje st√§mmer inte √∂verens med vittnesm√•len.</p>
                      <button 
                        onClick={() => setGameState('playing')}
                        className="bg-white text-red-600 px-6 py-2 rounded-lg font-bold hover:bg-red-50"
                      >
                        Forts√§tt utreda
                      </button>
                    </div>
                  )}
                </div>

              </main>
            </div>
          );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TimeMysteryGame />);
    </script>
</body>
</html>

